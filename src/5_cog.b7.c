#include <gb/gb.h>

extern const unsigned char Cog_Tiles[];
extern const unsigned char Cog_Tiles_Anim[];
extern const unsigned char Cog_TilesPAL[];
extern const unsigned char Cog_MapPLN0[];
extern const unsigned char Cog_MapPLN1[];
extern UINT16 TIMER;

extern UINT8 Scene;
extern UINT8 v;
extern UINT8 SPR;
extern UINT8 SSPEED;
UINT8 RPal2;
UINT16 RPalOffset; 
int CogOffset; 	
void Set_Lines_Pal(UINT16 *rgb_data);
void DMA_TRANSFER(UINT8 tiles, UINT16 *source,UINT16 *destination);

const UWORD CogDegrade[] =
{
	24311, 24311, 24311, 24311, 22197, 17969, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 15855, 13741, 11627, 11627, 8456, 7399, 17732, 
	21893, 21893, 21893, 25030, 25030, 25030, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 29159, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 29159, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 28169, 24277, 24311, 
	24311, 24311, 24311, 24311, 24311, 23254, 17969, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 15855, 12684, 11627, 11627, 11627, 11627, 
	11627, 8456, 7399, 6592, 8736, 8736, 8736, 9824, 
	9824, 9824, 10944, 10944, 10944, 10944, 10944, 10944, 
	10944, 10944, 10944, 10944, 10944, 10944, 10944, 10944,
	24311, 24311, 24311, 24311, 22197, 17969, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 15855, 13741, 11627, 11627, 8456, 7399, 17732, 
	21893, 21893, 21893, 25030, 25030, 25030, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 29159, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 29159, 29159, 29159, 
	29159, 29159, 29159, 29159, 29159, 28169, 24277, 24311, 
	24311, 24311, 24311, 24311, 24311, 23254, 17969, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 16912, 16912, 16912, 16912, 16912, 16912, 
	16912, 16912, 15855, 12684, 11627, 11627, 11627, 11627, 
	11627, 8456, 7399, 6592, 8736, 8736, 8736, 9824, 
	9824, 9824, 10944, 10944, 10944, 10944, 10944, 10944, 
	10944, 10944, 10944, 10944, 10944, 10944, 10944, 10944
	
};


void Cog_Update(){
	DMA_TRANSFER(38, Cog_Tiles_Anim+CogOffset,(UINT16*)0x9010); 
	
	//Set_Lines_Pal(CogDegrade + RPalOffset);
	
	TIMER++;
	CogOffset+=608;
	
	SSPEED++;;
	
	if (SSPEED == 2){SSPEED = 0;RPalOffset++;}
	if (CogOffset == 9728)CogOffset = 0;
	
	if (RPalOffset == 144)RPalOffset = 0;
	
	if ((TIMER > 12) && (TIMER < 49))WY_REG+=4;
	if ((TIMER > 730) && (TIMER < 767))WY_REG-=4;
	
	if (TIMER == 768){TIMER = 0; Scene++;}
}

void Cog_Set(){
    TIMER = 0; 
	
	VBK_REG = 0;	   
		set_bkg_tiles( 0, 0, 20, 18, Cog_MapPLN0); //tiles
		set_bkg_data( 0, 50, Cog_Tiles); //tile bank 1
	VBK_REG = 1;	   
		set_bkg_tiles( 0, 0, 20, 18, Cog_MapPLN1); //tiles
	VBK_REG = 0;	
	
	set_bkg_palette(0, 8, Cog_TilesPAL); //tile bank 1
	
	SHOW_BKG;
	HIDE_SPRITES;
	
	CogOffset = 0;
	RPalOffset = 0;
	SSPEED = 0;
	Scene++;
}	

void Cog_Run(){
	Set_Lines_Pal(CogDegrade + RPalOffset);
}